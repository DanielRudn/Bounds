package com.dr.bounds.maps.maptypes;

import com.badlogic.gdx.math.Intersector;
import com.dr.bounds.AssetManager;
import com.dr.bounds.MainGame;
import com.dr.bounds.Player;
import com.dr.bounds.maps.obstacles.dRotatingObstacle;

public class RotatingMapType extends MapType{

	public RotatingMapType(int type, Player player, MapGenerator generator) {
		super(type, player, generator, AssetManager.getBackground("DEFAULT_BG.png"));
		this.MIN_WIDTH = 256;
		this.MAX_WIDTH = 456 - MIN_WIDTH / 2;
		this.MIN_DISTANCE = 512;
		this.MAX_DISTANCE = (int)MainGame.VIRTUAL_HEIGHT;
		
		this.typeName = "ROTATING";
		gen.setScoreIncrementAmount(1);

		for(int x = 0; x < 5; x++)
		{
			obstacles.add(new dRotatingObstacle(0,0, AssetManager.getTexture("card"), player));
			obstacles.get(x).setRegenerate(false);
		}
	}
	
	@Override
	protected void checkCollision(int index)
	{
		if(Intersector.distanceSegmentPoint(getObstacles().get(index).getSprite().getVertices()[0], getObstacles().get(index).getSprite().getVertices()[1],
				getObstacles().get(index).getSprite().getVertices()[15], getObstacles().get(index).getSprite().getVertices()[16],
				player.getX() + player.getWidth()/2f,
				player.getY() + player.getHeight()/2f) <= player.getWidth() / 2f)
		{
			gen.setHadCollision(true);
		}
		if(Intersector.distanceSegmentPoint(getObstacles().get(index).getSprite().getVertices()[5], getObstacles().get(index).getSprite().getVertices()[6],
				getObstacles().get(index).getSprite().getVertices()[10], getObstacles().get(index).getSprite().getVertices()[11],
				player.getX() + player.getWidth()/2f,
				player.getY() + player.getHeight()/2f) <= player.getWidth() / 2f)
		{
			gen.setHadCollision(true);
		}
	}
	
	@Override
	protected void generateBlock(int index)
	{
		((dRotatingObstacle)obstacles.get(index)).setRotation(0);
		obstacles.get(index).setWidth(MIN_WIDTH + MapGenerator.rng.nextInt(MAX_WIDTH) - 32f);
		obstacles.get(index).setHeight(8f + MapGenerator.rng.nextInt(48));
		obstacles.get(index).setOriginCenter();
		System.out.println("index: " + index + " originX: " + obstacles.get(index).getOriginX() + " Y:" + obstacles.get(index).getOriginY());
		int side = MapGenerator.rng.nextInt(1);
		if(side == 0) // center
		{
			obstacles.get(index).setX(MainGame.VIRTUAL_WIDTH / 2f - obstacles.get(index).getWidth()/2f);
		}
		else if(side == 1)// left
		{
			obstacles.get(index).setX(-obstacles.get(index).getWidth()/2f);
		}
		else if(side == 2)// right
		{
			obstacles.get(index).setX(MainGame.VIRTUAL_WIDTH - obstacles.get(index).getWidth()/2f);
		}
		obstacles.get(index).setY(obstacles.get(getPreviousIndex(index)).getY() - MIN_DISTANCE - MapGenerator.rng.nextInt(MAX_DISTANCE));
	}

}
